name: Monitor Bot

on:
  schedule:
    - cron: "*/15 * * * *" # a cada 15 min

jobs:
  check:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: main

      - name: Atualizar repositÃ³rio
        run: |
          git pull origin main

      - name: Ler heartbeat
        id: readhb
        run: |
          if [ ! -f last_heartbeat.txt ]; then
            echo "0" > last_heartbeat.txt
          fi

          NOW=$(date +%s)
          LAST=$(cat last_heartbeat.txt)
          DIFF=$((NOW - LAST))
          echo "diff=$DIFF" >> $GITHUB_OUTPUT

      - name: Notificar se estiver offline
        if: ${{ steps.readhb.outputs.diff > 1200 }}
        run: |
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{\"content\": \"ðŸš¨ **BOT OFFLINE!**\nNenhum status recebido hÃ¡ mais de 20 minutos.\n**Verificar servidor assim que possÃ­vel!** <@329429623945297921><@920632184396738601>\"}" \
               https://discord.com/api/webhooks/1446507675247575113/ZCdaGeMOvyx9VNopRfYh93EK0ubOJRNgK0iAofxCCP17MC_QFV8apT82IcTGm-ML8QOS
